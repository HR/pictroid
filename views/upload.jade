extends layout

block head
	title Upload | Pictroid

block variables
	- var bodyStyle = "background-image: url(/images/wallpaper.jpg); background-color: #000000;"
	- var headerClasses = 'navbar-fixed-top navbar-transparent'

block content
	.jumbotron.dark.center(style="background: transparent;")
		form.form-transparent(role="form", action="/signup", method="POST", onsubmit="return(validate());")
			img(src="/images/logo/icon.png", alt="Pictroid", height="75")
			hr
			input.form-control(type="file", id="image", name="image")
			textarea.form-control(type="text", name="description", placeholder="Description" row="20")
			input.form-control(type="text", name="tags", placeholder="#Tags")
			p(id="emsg" style="color:#DD7674;")
			button.btn.btn-lg.btn-primary.btn-block(type="submit") Upload
			script.
				$('#image').bind('change', function() {
					validate(this.files[0].size);
				});
				function validate(imgSize){
					var valid = false,
						form = window.document.forms[0],
						emsg = window.document.querySelectorAll("#emsg")[0],
						fileName = $(form.image).val(),
						imgSize = (imgSize) ? readImage($("#image")[0].files[0]) : false; 
					valid = ((/^.{0,500}$/g).test(form.description.value) && ( /^([A-Z0-9]{2,9},{1}(\s{1})?)+([A-Z0-9]{2,9})$/ig).test(form.tags.value)) ? true : false;
					valid = (fileName.lastIndexOf("gif")===fileName.length-3) ? true : false;
					console.log(imgSize);
					if (valid) {
						emsg.innerHTML = "";
						return valid;
					} else {
						emsg.innerHTML = "Invalid credentials supplied";
						return valid;
					}
				}
				function readImage(file) {
					var reader = new FileReader(),
						image  = new Image();
					reader.readAsDataURL(file);  
					reader.onload = function(_file) {
						image.src = _file.target.result;
						image.onload = function() {
								var w = this.width,
								h = this.height,
								t = file.type;
						};
						image.onerror= function() {
							alert('Invalid file type: '+ file.type);
						};      
				};